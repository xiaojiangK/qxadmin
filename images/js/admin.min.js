/*!
 * qx-admin.js v1.0.0
 * (c) 2019 Qinxin-XiaojiangK
 * Released under the QiuXin License.
 */

// globalFn
const t = {
    Progress: function(){
        var progress={textheight:null,renders:function(id,length,r,percent,color){var canvas = $(`#${id}`)[0], context=canvas.getContext("2d");canvas.width=length;canvas.height=length;var i=0, interval=setInterval(function(){i++;progress.render(context,length,r,i,percent,color);if(i>=percent){clearInterval(interval)}},10)},render:function(context,length,r,i,percent,color){context.clearRect(0,0,length,length);context.beginPath();var gradient=context.createLinearGradient(length,0,0,0);gradient.addColorStop("0",color.start);gradient.addColorStop("1.0",color.end);context.strokeStyle=gradient;context.lineWidth=r;context.arc(length/2,length/2,length/2-r,-0.5*Math.PI,-0.5*Math.PI+i*0.02*Math.PI,false);context.stroke();context.closePath();context.beginPath();context.strokeStyle="#8d8d8d";context.lineWidth=2;context.fillStyle="#ffffff";context.arc(length/2,r,0.6*r,0,2*Math.PI,false);context.stroke();context.fill();context.closePath();context.beginPath();var radian=(percent/100)*2*Math.PI-0.5*Math.PI, x=Math.cos(radian)*(length/2-r)+length/2, y=Math.sin(radian)*(length/2-r)+length/2;context.arc(x,y,0.6*r,0,2*Math.PI,false);context.stroke();context.fill();context.closePath();context.beginPath();context.lineWidth=1;context.strokeStyle="#54DDAF";context.fillStyle=color.bg;context.arc(length/2,length/2,length/2-2*r,0,2*Math.PI);context.fill();context.closePath();context.beginPath();context.font="bold "+(length/2-2.5*r)/2+"px 微软雅黑";context.fillStyle=color.end;var text=percent+"%";textwidth=context.measureText(text).width;if(this.textheight==null){var div=document.createElement("div");document.body.appendChild(div);div.innerHTML=text;div.style.fontSize=(length/2-2.5*r)/2+"px";this.textheight=div.offsetHeight;div.parentNode.removeChild(div)}textheight=this.textheight;context.fillText(text,(length-textwidth)/2,length/2+textheight/4);context.fill();context.closePath()}};return progress
    },
    // Fuzzy query
    fuzzyQuery: function (list, key) {
        var reg = new RegExp(key), arr = [];
        for (var i = 0; i < list.length; i++) {
            if (reg.test(list[i])) {
                arr.push(list[i]);
            }
        }
        return arr.length > 0 ? true : false;
    },
    // Scrollvisble
    scrollVisble: function (that) {
        var bar = $('.qx-scrollbar_bar',that),
        wrap = $('.qx-scrollbar_wrap',that),
        selectH = $('.qx-select_list',that).height(),
        scrollH = $('.qx-scrollbar',that).height(),
        scale = scrollH / selectH;
        if (selectH > scrollH) {
            $(bar).css({
                'top': 0,
                'display': 'block',
                'height': scale * scrollH
            });
            $(wrap).scrollTop(0);
        } else {
            $(bar).css('display', 'none');
        }
        var barH = $(bar).height();
        $(wrap).scroll(function (){
            var top = $(this).scrollTop();
            if (top > scrollH - barH) {
                top = scrollH - barH;
            }
            $(this).siblings('.qx-scrollbar_bar').css('top', top);
        });
    },
    // hasClass
    hasClass: function (that, i) {
        return $(that).hasClass(i);
    },
    getStorage(key) {
        return localStorage.getItem(key) ? JSON.parse(localStorage.getItem(key)) : [];
    },
    setStorage(key, val) {
        localStorage.setItem(key, val);
    },
    getAttr(obj, attr) {
        return $(obj).attr(attr) != undefined ? true : false
    },
    setFrameSrc(iframe) {
        if (!$(iframe).attr('src')) {
            $(iframe).attr('src', $(iframe).attr('data-src'));
        }
    }
};

// globalData
const g = {
    radioed: {},
    checked: [],
    selectd: [],
    itemLen: 0,
    paneLen: 0,
    icon: "info,infos,success,successs,hook,error,hollow-close,warning,warnings,fileopen,retract,see,sees,max,refresh,ref-left,ref-right,arrowright,arrowleft,arrowdown,arrowup,left-round,right-round,magnifier,uploadpic,others,notice,adjust,data,form,navigation,share,shares,loading,spinner,uploads,upload,forks,close,closes,seekicon,searchs,payconfig,coin,export,daochu,weChat,alipay,icondown,iconup,users,user,resets,reset,edits,edit,password,passwd,remove,delete,adds,add,menu,menuopen,finance,wallet,custom,customs,fork,fork-spoon,square-full,goblet-full,cream-square,goblet,cup,hot-water,cream-round,potato-strips,cold-drink,cloudy-sunny,aid-kit,off-microphone,chat-round,chatline-round,chatdot-round,chatdot-square,takeaway-box,docs,cilun,eb,thunder,switchbtn,coffee,home-normal,home,cream,tickets,web,headset,chilun,hollowbuy,buy,cooperate,plus,aircraft,fullmore,more,help,outlinehelp,female,male,play,platform,outlinereduce,qrcode,picture,mingfood,message,refrigerator,alarmclock,alarmclocks,mouse,goods,dish,doc,bicycle,scan,printing,tools,toolss,toolsbox,toolsboxs,clip,place,places,cloudy,messages,mobile,mobiles,link,trophy,sunny,shangji,truck,trophystar,clasphands,lollipop,watch,watchs,plane,pause,pictures,camera,scissors,doubleright,doubleleft,minus,cameras,phone,phonecall,goodss,car,stars,star,videos,video,voice,check,umbrella",
    selectedNav: t.getStorage('tagList')
};

// Base
class Base {
    constructor() {}
    ajax(opt) {
        var options = {
            url: '',
            data: {},
            jsonp: '',
            async: true,
            type: 'get',
            dataType: '',
            error() {},
            success() {},
            complete() {},
            beforeSend() {},
            contentType: 'application/x-www-form-urlencoded'
        },
        opts = $.extend(options, opt);
        $.ajax({
            url: opts.url,
            data: opts.data,
            jsonp: opts.jsonp,
            async: opts.async,
            type: opts.type,
            dataType: opts.dataType,
            contentType: opts.contentType,
            success (res){
                opts.success && opts.success(res);
                if (opts.successMsg) {
                    $(this).message({
                        type: 'success',
                        msg: opts.successMsg
                    });
                }
                if (opts.refresh) {
                    window.location.reload();
                }
                if (opts.link) {
                    window.location.href = opts.link;
                }
                if (opts.obj && opts.html) {
                    $(opts.obj).html(opts.html);
                }
            },
            error (res){
                opts.error && opts.error(res);
                if (opts.errorMsg) {
                    $(this).message({
                        type: 'error',
                        msg: opts.errorMsg
                    });
                }
                if (opts.refresh) {
                    window.location.reload();
                }
            },
            complete (res){
                opts.complete && opts.complete(res);
                if (opts.refresh) {
                    window.location.reload();
                }
            },
            beforeSend (res){
                opts.beforeSend && opts.beforeSend(res);
            }
        });
    }
    success(opt) {
        var options = {
            parentRefresh: false,
            refresh: false,
            remove: false,
            type: 'success',
            closeLayer: false
        },
        opts = $.extend(options, opt);
        if (opts.code) {
            if (opts.code == 100000) {
                if (opts.remove) {
                    $(opts.ele).remove();
                }
                if (opts.link) {
                    window.location.href = opts.link;
                }
                if (opts.refresh) {
                    window.location.reload();
                }
                if (opts.parentRefresh) {
                    parent.location.reload();
                }
                if (opts.msg) {
                    $(this).message({
                        type: opt.type,
                        msg: opts.msg
                    });
                }
                if (opts.closeLayer) {
                    $(this).closeLayer();
                }
            } else if (opts.code == 100002) {
                if (opts.link) {
                    window.location.href = '/login';
                }
                if (opts.msg) {
                    $(this).message({
                        type: opt.type,
                        msg: opts.msg
                    });
                }
            } else {
                if (opts.msg) {
                    $(this).message({
                        type: opt.type,
                        msg: opts.msg
                    });
                }
            }
        }
    }
    comfirm(opt) {
        var options = {
            type: 'warning',
            refresh: false,
            showCancel: true
        },
        opts = $.extend(options, opt);
        if (opts.msg) {
            $(this).messageBox({
                type: opts.type,
                message: opts.msg,
                showCancelBtn: opts.showCancel,
                confirm: function (){
                    opts.success && opts.success();
                    if (opts.refresh) {
                        window.location.reload();
                    }
                    if (opts.link) {
                        window.location.href = opts.link;
                    }
                    if (opts.obj && opts.html) {
                        $(opts.obj).html(opts.html);
                    }
                }
            });
        }
    }
    tips(opt) {
        var options = {
            type: 'success'
        },
        opts = $.extend(options, opt);
        if (opts.msg) {
            $(this).message({
                type: opts.type,
                msg: opts.msg
            });
            if (opts.obj && opts.html) {
                $(opts.obj).html(opts.html);
            }
        }
    }
    render(opt) {
        var options = {
            type: 'success'
        },
        opts = $.extend(options, opt);
        if (opts.msg) {
            $(this).message({
                type: opts.type,
                msg: opts.msg
            });
        }
        if (opts.obj && opts.html) {
            $(opts.obj).html(opts.html);
        }
    }
}

;(function($){
    // radio
    $.fn.radio = function (option){
        var config = {
            change: null
        },
        opts = $.extend(config, option);
        $(this).on('click', '.qx-radio', function (){
            var radio = $('.qx-radio_input',this);
            if (t.hasClass(radio, 'is-disabled')) return;
            var input = $('input',this);
            $('input',$(this).parent()).removeAttr('checked');
            $('.qx-radio_input',$(this).siblings()).removeClass('is-checked');
            $(this).attr('aria-checked', true).siblings().removeAttr('aria-checked');
            $(input).attr('checked', true);
            $(radio).addClass('is-checked');
            g.radioed[$(input).attr('name')] = $(input).val();
            opts.change && opts.change($(input).val());
            return false;
        });
    }
    // checkbox
    $.fn.checkbox = function (option){
        var config = {
            change: null
        },
        opts = $.extend(config, option);
        $(this).on('click', '.qx-checkbox', function (){
            var checkbox = $('.qx-checkbox_input',this);
            if (t.hasClass(checkbox, 'is-disabled')) return;
            var groupIdx = $(this).parent().attr('group-idx'),
            checkIdx = $(checkbox).attr('data-idx'),
            input = $('input',this),
            gIdx = groupIdx ? groupIdx : 0;
            if (t.hasClass(checkbox, 'is-checked')) {
                $(input).removeAttr('checked');
                $(this).removeAttr('aria-checked');
                $(checkbox).removeClass('is-checked');
                g.checked[gIdx] = g.checked[gIdx].filter(item => item.id != checkIdx);
            } else {
                $(input).attr('checked', true);
                $(this).attr('aria-checked', true);
                $(checkbox).addClass('is-checked');
                g.checked[gIdx].push({
                    id: checkIdx,
                    value: $(input).val()
                });
            }
            opts.change && opts.change(g.checked[gIdx]);
            return false;
        });
    }
    // select
    $.fn.select = function (option){
        var config = {
            change: null
        };
        var opts = $.extend(config, option);
        $(this).on('click', '.qx-select:not(.cascader)', function (e){
            var that = this, e = e || window.event;
            if (t.hasClass(this, 'is-disabled')) return;
            if (!t.hasClass(this, 'is-multiple')) {
                $('.qx-select-dropdown').slideUp('fast');
            }
            $('.qx-select_item',this).show();
            var arrow = $('.qx-select .icon-arrowdown');
            $(arrow).css('transform', 'rotate(0)');
            var input = $('.qx-input_inner',this),
            dropdown = $('.qx-select-dropdown',this);
            // search
            if (t.hasClass(this, 'is-filter')) {
                $(input).on('input', function (){
                    var result = [],
                    keyword = $(this).val(),
                    empty = $('.qx-select_empty',that),
                    selectItem = $('.qx-select_item',that);
                    if (keyword == '') {
                        $(selectItem).show();
                        $(empty).hide().text('');
                        t.scrollVisble(that);
                        return;
                    }
                    $(selectItem).each(function (){
                        var text = $(this).text();
                        if (t.fuzzyQuery(text.split(''), keyword) || text == keyword) {
                            $(this).show();
                            result.push(text);
                        } else {
                            $(this).hide();
                        }
                    });
                    if (result.length == 0) {
                        t.scrollVisble(that);
                        $(empty).show().text('无匹配数据');
                    } else {
                        t.scrollVisble(that);
                        $(empty).hide().text('');
                    }
                    return;
                });
            }
            if ($(dropdown).css('display') == 'none') {
                $(dropdown).slideDown('fast');
                var iconarrow = $('.icon-arrowdown',this);
                $(iconarrow).css('transform', 'rotate(180deg)');
                t.scrollVisble(this);
                $(document).click(function (){
                    $(dropdown).slideUp('fast');
                    $(iconarrow).css('transform', 'rotate(0)');
                });
            } else {
                if (e.target.nodeName != 'LI') {
                    $(dropdown).slideUp('fast');
                }
                $(arrow).css('transform', 'rotate(0)');
            }
            $('.qx-select_item',this).each(function (){
                $(this).off().on('click', function (){
                    var key = $('input[type=text]',$(this).parents('.qx-select')).attr('name')
                    // 多选
                    if (t.hasClass(that, 'is-multiple')) {
                        var value = $(this).attr('data-val');
                        if (t.hasClass(this, 'active')) {
                            $(this).removeClass('active');
                            g.selectd = g.selectd.filter(item => item.value != value);
                        } else {
                            $(this).addClass('active');
                            g.selectd.push({
                                value, label: $(this).text()
                            });
                        }
                        var label = '', val = '';
                        g.selectd.map((item, index) => {
                            if (index == g.selectd.length - 1) {
                                val += item.value;
                                label += item.label;
                            } else {
                                val += `${item.value} / `;
                                label += `${item.label} / `;
                            }
                        });
                        $(input).val(label).attr('data-value', val);
                        opts.change && opts.change({
                            key,
                            data: g.selectd
                        });
                        return;
                    }
                    if ($(this).parents('.icon').length) {
                        var label = 'icon',
                        value = $('i',this).attr('class');
                        $(input).siblings('.iconfont').remove();
                        $(input).parent().append(`<i class="${value}"></i>`);
                        $(input).val(' ').attr('data-value', value);
                    } else {
                        var value = $(this).attr('data-val'),
                        label = $(this).text();
                        $(input).val(label).attr('data-value', value);
                    }
                    $(this).addClass('active').siblings().removeClass('active');
                    opts.change && opts.change({
                        key,
                        data: {
                            value,
                            label
                        }
                    });
                });
            });
            return false;
        });
    }
    // switch
    $.fn.switch = function (option){
        var config = {
            change: null
        },
        opts = $.extend(config, option);
        $(this).on('click', '.qx-switch', function (){
            if (t.hasClass(this, 'is-disabled')) return;
            var value = '',
            input = $('input',this),
            trueVal = $(input).attr('true-value'),
            falseVal = $(input).attr('false-value');
            if (t.hasClass(this, 'is-checked')) {
                value = falseVal ? falseVal : false;
                $(input).removeAttr('checked');
                $(this).removeClass('is-checked');
                $('.qx-switch_label',this).removeClass('is-active').eq(0).addClass('is-active');
            } else {
                value = trueVal ? trueVal : true;
                $(this).addClass('is-checked');
                $(input).attr('checked', true);
                $('.qx-switch_label',this).removeClass('is-active').eq(1).addClass('is-active');
            }
            opts.change && opts.change(value);
            return false;
        });
    }
    // input
    $.fn.input = function (option){
        var config = {
            change: null,
            blur: null
        },
        opts = $.extend(config, option);
        $(this).on('click', '.icon-closes', function (){
            $('input',$(this).parents('.qx-input')).val('');
            return false;
        });
        $(this).on('click', '.icon-see', function (){
            var input = $('input',$(this).parents('.qx-input'));
            if ($(input).attr('type') == 'text') {
                $(this).removeClass('icon-sees')
                $(input).attr('type', 'password');
            } else {
                $(this).addClass('icon-sees')
                $(input).attr('type', 'text');
            }
            return false;
        });
        $(this).on('input', '.qx-input_inner', function (){
            var parent = $(this).parents('.qx-input');
            if (t.hasClass(parent, 'showWord')) {
                $('.num',parent).text($(this).val().length);
            }
            opts.change && opts.change($(this).val());
            return false;
        });
        if (opts.blur) {
            $(this).on('blur', '.qx-input_inner', function (){
                opts.blur($(this).val());
            });
            $(this).on('blur', '.qx-area_inner', function (){
                opts.blur($(this).val());
            });
        }
        $(this).on('input', '.qx-area_inner', function (){
            var parent = $(this).parents('.qx-textarea');
            if (t.hasClass(parent, 'showWord')) {
                $('.num',parent).text($(this).val().length);
            }
            opts.change && opts.change($(this).val());
            return false;
        });
    }
    // DatePicker
    $.fn.DatePicker = function (option){
        var config = {
            min: false,
            max: false,
            format: 'YYYY-MM-DD HH:mm:ss',
            isRange: false,
            between: false,
            hasShortcut: false,
            shortcutOptions: [],
            hide: null
        },
        val = [],
        opts = $.extend(config, option),
        input = $('input',this);
        $('.qx-datepicker-editor',this).datePicker({
            min: opts.min,
            max: opts.max,
            format: opts.format,
            isRange: opts.isRange,
            between: opts.between,
            hasShortcut: opts.hasShortcut,
            shortcutOptions: opts.shortcutOptions,
            hide: function (e){
                val = [];
                if (input.length == 1) {
                    val = $(input).val();
                } else {
                    for (let i of input) {
                        val.push($(i).val());
                    }
                }
                opts.hide && opts.hide(val, e);
            }
        });
    }
    // Page
    var zp = {
        init: function(obj, page) {
            return (function() {
                obj.off();
                zp.addhtml(obj, page);
                zp.bindEvent(obj, page);
            } ());
        },
        addhtml: function(obj, page) {
            if (page.current > page.pageNum) {
                page.current = page.pageNum;
            }
            return (function() {
                obj.empty();
                if (page.current > 1) {
                    obj.append('<a href="javascript:;" class="prebtn">上一页</a>');
                } else {
                    obj.remove('.prevPage');
                    obj.append('<span class="disabled">上一页</span>');
                }
                if (page.current > 4 && page.pageNum > 4) {
                    obj.append('<a href="javascript:;" class="zxfPagenum">' + 1 + '</a>');
                    obj.append('<a href="javascript:;" class="zxfPagenum">' + 2 + '</a>');
                    obj.append('<span class="dot">...</span>');
                }
                if (page.current > 4 && page.current <= page.pageNum - 5) {
                    var start = page.current - 2,
                    end = page.current + 2;
                } else if (page.current > 4 && page.current > page.pageNum - 5) {
                    var start = page.pageNum - 4,
                    end = page.pageNum;
                } else {
                    var start = 1,
                    end = 9;
                }
                for (; start <= end; start++) {
                    if (start <= page.pageNum && start >= 1) {
                        if (start == page.current) {
                            obj.append('<span class="current">' + start + '</span>');
                        } else if (start == page.current + 1) {
                            obj.append('<a href="javascript:;" class="zxfPagenum nextpage">' + start + '</a>');
                        } else {
                            obj.append('<a href="javascript:;" class="zxfPagenum">' + start + '</a>');
                        }
                    }
                }
                if (end < page.pageNum) {
                    obj.append('<span class="dot">...</span>');
                }
                if (page.current >= page.pageNum) {
                    obj.remove('.nextbtn');
                    obj.append('<span class="disabled">下一页</span>');
                } else {
                    obj.append('<a href="javascript:;" class="nextbtn">下一页</a>');
                }
                obj.append('<span>' + '共' + '<b>' + page.pageNum + '</b>' + '页，' + '</span>');
                obj.append('<span>' + '到第' + '<input type="number" class="zxfinput" value="'+ page.current +'"/>' + '页' + '</span>');
            } ());
        },
        bindEvent: function(obj, page) {
            return (function() {
                obj.on("click", "a.prebtn",
                function() {
                    var cur = Number.parseInt(obj.children("span.current").text());
                    var current = $.extend(page, {
                        "current": cur - 1
                    });
                    zp.addhtml(obj, current);
                    if (typeof(page.backfun) == "function") {
                        page.backfun(current);
                    }
                });
                obj.on("click", "a.zxfPagenum",
                function() {
                    var cur = Number.parseInt($(this).text());
                    var current = $.extend(page, {
                        "current": cur
                    });
                    zp.addhtml(obj, current);
                    if (typeof(page.backfun) == "function") {
                        page.backfun(current);
                    }
                });
                obj.on("click", "a.nextbtn",
                function() {
                    var cur = Number.parseInt(obj.children("span.current").text());
                    var current = $.extend(page, {
                        "current": cur + 1
                    });
                    zp.addhtml(obj, current);
                    if (typeof(page.backfun) == "function") {
                        page.backfun(current);
                    }
                });
                obj.on('blur', 'input.zxfinput', function (){
                    var cur = Number.parseInt($(this).val());
                    var current = $.extend(page, {
                        "current": cur
                    });
                    zp.addhtml(obj, current);
                    if (typeof(page.backfun) == "function") {
                        page.backfun(current);
                    }
                });
            } ());
        }
    }
    $.fn.createPage = function(option) {
        var page = $.extend({
            pageNum: 10,
            current: 1,
            backfun() {}
        }, option);
        zp.init($('.pagination',this), page);
    }

    // tabs
    $.fn.tabs = function (option){
        var config = {
            click: null,
            remove: null,
            addItem: null
        },
        opts = $.extend(config, option);
        $(this).off().on('click', '.qx-tabs_item', function (){
            var index = $(this).attr('data-idx'),
            pane = $('.qx-tab-pane',$(this).parents('.qx-tabs'));
            $(this).addClass('active').siblings().removeClass('active');
            $(pane).each(function (){
                if ($(this).attr('data-idx') == index) {
                    t.setFrameSrc($('iframe',this));
                    $(this).addClass('active').siblings().removeClass('active');
                }
            });
            opts.click && opts.click($(this).text());
        });
        $(this).on('click', '.icon-forks', function (){
            var pane = $('.qx-tab-pane',$(this).parents('.qx-tabs'));
            if (pane.length == 1) return;
            if ($(this).parents('.nav')) {
                // remove
                var curItem = $(this).parent().text().trim();
                for (let i = 0; i < g.selectedNav.length; i++) {
                    if (curItem == g.selectedNav[i].title) {
                        g.selectedNav.splice(i, 1);
                    }
                }
                t.setStorage('tagList', JSON.stringify(g.selectedNav));
            }
            var item = $(this).parent('.qx-tabs_item'),
            index = $(item).attr('data-idx');
            if (t.hasClass(item, 'active')) {
                var next = $(item).next('.qx-tabs_item'),
                prev = $(item).prev('.qx-tabs_item');
                if (next.length) {
                    next.addClass('active');
                    $(pane).each(function (){
                        if ($(this).attr('data-idx') == index) {
                            $(this).next().addClass('active');
                            t.setFrameSrc($('iframe',$(this).next()));
                        }
                    });
                } else {
                    prev.addClass('active');
                    $(pane).each(function (){
                        if ($(this).attr('data-idx') == index) {
                            $(this).prev().addClass('active');
                            t.setFrameSrc($('iframe',$(this).prev()));
                        }
                    });
                }
            }
            $(item).remove();
            $(pane).each(function (){
                if ($(this).attr('data-idx') == index) {
                    $(this).remove();
                }
            });
            opts.remove && opts.remove($(item).text());
        });
        // addTab
        if (opts.addItem) {
            var pack = opts.addItem.pack ? opts.addItem.pack : 'body',
            title = opts.addItem.title ? opts.addItem.title : 'New Tabs',
            content = opts.addItem.content ? opts.addItem.content : 'New Tabs Content',
            isClose = t.hasClass($('.qx-tabs',pack), 'closable');
            $('.qx-tabs_item,.qx-tab-pane',pack).removeClass('active');
            $('.qx-tabs_nav',pack).append(`<div class="qx-tabs_item active" data-idx="${g.itemLen++}">${title} ${isClose ? `<span class="iconfont icon-forks"></span>` : ''}</div>`);
            $('.qx-tabs_con',pack).append(`<div class="qx-tab-pane active" data-idx="${g.paneLen++}">${content}</div>`);
        }
    }

    // message
    $.fn.message = function (option){
        var config = {
            msg: 'This is a message',
            type: 'info',
            duration: 2000,
            showClose: false
        },
        opts = $.extend(config, option);
        $('.qx-message').remove();
        $('body').append(`
            <div role="alert" class="qx-message qx-message-${opts.type} ${opts.showClose ? 'is-closable' : ''}">
                <i class="iconfont icon-${opts.type}"></i>
                <p class="qx-message_con">${opts.msg}</p>
                ${opts.showClose ? `<i class="iconfont icon-forks"></i>` : ''}
            </div>
        `);
        $('.qx-message').each(function (){
            $('.icon-forks',this).on('click', function (){
                $(this).parent('.qx-message').css({
                    opacity: 0,transform: 'translate3d(-50%,-100%,0)'
                });
            });
            $(this).delay(opts.duration).animate({
                top: '-100%',opacity: 0
            }, 'slow', function (){
                $(this).remove();
            });
        });
    }

    // checkForm
    $.fn.validate = function (option){
        var config = {},
        flag = true,
        data = {},
        opts = $.extend(config, option);
        $('.qx-form-item',this).each(function (){
            var that = this,
            prop = $(this).attr('prop'),
            qxInput = $('.qx-input',this),
            content = $('.qx-form_con',this),
            date = $('.qx-datepicker-editor',this);
            for (let i in opts) {
                if (i == prop) {
                    var r = opts[i];
                    function checkInput(v) {
                        $('.qx-form_error',that).remove();
                        if ((r.required&&!v) || v.length < r.min || v.length > r.max || (r.pattern && !r.pattern.test(v))) {
                            $(qxInput).addClass('error');
                            $(content).append(`<div class="qx-form_error">${r.message}</div>`);
                            flag = false;
                        } else {
                            $(qxInput).removeClass('error');
                        }
                        return false;
                    }
                    function checkBox(t) {
                        var idx = $(t).parent().attr('group-idx') || 0;
                        setTimeout(() => {
                            var len = g.checked[idx].length;
                            $('.qx-form_error',that).remove();
                            if ((r.required&&len == 0) || len > r.max || len < r.min) {
                                $(content).append(`<div class="qx-form_error">${r.message}</div>`);
                                flag = false;
                            }
                        }, 0);
                        return false;
                    }
                    function checkRadio(name) {
                        $('.qx-form_error',that).remove();
                        setTimeout(() => {
                            if (r.required && !g.radioed[name]) {
                                $(content).append(`<div class="qx-form_error">${r.message}</div>`);
                                flag = false;
                            }
                        }, 0);
                        return false;
                    }
                    // Submit Form
                    if (opts.type && opts.type == 'submit') {
                        $('.qx-input input',this).each(function (){
                            var name = $(this).attr('name'),
                            value = $(this).attr('data-value')
                            if (value) {
                                data[name] = value;
                            } else {
                                data[name] = $(this).val();
                            }
                            checkInput($(this).val());
                        });
                        $('textarea',this).each(function (){
                            var name = $(this).attr('name');
                            data[name] = $(this).val();
                            checkInput($(this).val());
                        });
                        $('.qx-checkbox',this).each(function (index){
                            checkBox(this);
                            if ($(this).attr('aria-checked')) {
                                var input = $('input',this),
                                name = $(input).attr('name');
                                data[name] = data[name] ? data[name] : '';
                                data[name] += $(input).val()+',';
                            }
                        });
                        $('.qx-radio',this).each(function (){
                            var input = $('input',this),
                            name = $(input).attr('name');
                            checkRadio(name);
                            if (t.getAttr(input, 'checked')) {
                                data[name] = $(input).val();
                            }
                        });
                    }
                    // Reset Form
                    if (opts.type && opts.type == 'reset') {
                        $(date).removeClass('error');
                        $(qxInput).removeClass('error');
                        $('.qx-form_error',that).remove();
                    }
                    $(this).on('click', '.cascader-menu li', function (){
                        if ($('.icon-check',this)) {
                            $('.cascader+.qx-form_error',that).remove();
                            $('.qx-cascader .error',that).removeClass('error');
                        }
                    });
                    $('input, textarea',this).on('input', function (){
                        checkInput($(this).val());
                    });
                    $('.qx-checkbox',this).each(function (){
                        $(this).on('click', function (){
                            checkBox(this);
                        });
                    });
                    $('.qx-radio',this).each(function (){
                        $(this).on('click', function (){
                            var input = $('input',this),
                            name = $(input).attr('name');
                            checkRadio(name);
                        });
                    });
                    $('.qx-select input',this).on('blur',function (){
                        setTimeout(() => {
                            checkInput($(this).val());
                        }, 120);
                    });
                    $('.c-datepicker-data-input',this).on('blur',function (){
                        setTimeout(() => {
                            checkInput($(this).val());
                        }, 120);
                    });
                }
            };
        });
        setTimeout(() => {
            opts.valid && opts.valid({
                data,
                valid: flag
            });
        }, 0)
    }

    // getFormData
    $.fn.getForm = function (option){
        var data = {},
        config = {},
        opts = $.extend(config, option);
        setTimeout(() => {
            for (let i of $('input',this)) {
                var name = $(i).attr('name');
                if ($(i).attr('type') == 'checkbox') {
                    if ($(i).parent().hasClass('qx-switch')) {
                        data[name] = $(i).attr('checked') ? true : false;
                    } else {
                        if ($(i).attr('checked')) {
                            data[name] = data[name] ? data[name] : '';
                            data[name] += $(i).val()+',';
                        }
                    }
                } else if ($(i).attr('type') == 'radio') {
                    if ($(i).attr('checked')) {
                        data[name] = $(i).val();
                    }
                }else {
                    var value = $(i).attr('data-value');
                    if (value) {
                        data[name] = value;
                    } else {
                        data[name] = $(i).val();
                    }
                }
            }
            for (let i of $('textarea',this)) {
                var name = $(i).attr('name');
                data[name] = $(i).val();
            }
            opts.success && opts.success(data);
        });
    };

    // upload
    $.fn.upload = function (option){
        var config = {
            maxLength: 9
        },
        files = $(this)[0].files,
        opts = $.extend(config, option);
        if (opts.el) {
            // 限制数量
            var uplaod = $('.icon-uploadpic',$(opts.el));
            if (opts.type == 'avatar') {
                if (files.length == 1) {
                    $(uplaod).fadeOut();
                } else {
                    $(this).message({
                        type: 'error',
                        msg: '对不起，头像只能上传一张',
                    });
                    return;
                }
            }
            if (opts.type == 'photo') {
                if (files.length > opts.maxLength) {
                    $(this).message({
                        type: 'error',
                        msg: `对不起，照片墙最多上传${opts.maxLength}张`,
                    });
                    return;
                } else if (files.length == opts.maxLength) {
                    $(uplaod).fadeOut();
                }
            }
            // 删除
            $(opts.el).on('click', '.icon-remove', function (){
                $(uplaod).fadeIn();
                $(this).parents('.cover').animate({
                    'opacity': 0,'top': '-30px'
                }, 'slow', function (){
                    $(this).remove()
                });
            });
        }
        $.each(files,function(k,i){
            if (!/image\/\w+/.test(i.type)) {
                $(this).message({
                    type: 'error',
                    msg: '对不起，只能上传图片类型文件',
                });
                return false;
            }
            var formData = new FormData();
            formData.append("file", i);
            var reader = new FileReader();
            reader.readAsDataURL(i);
            reader.onload = function() {
                var imgSrc = this.result;
                if (opts.el) {
                    var imgs = document.createElement("img");
                    $(imgs).attr("src", imgSrc);
                    $(imgs).css("animation", 'fadeIn .8s');
                    $(opts.el).prepend(imgs);
                    $('.mask',$(opts.el)).remove();
                    $(imgs).wrapAll('<div class="cover"></div>');
                    $('.cover',$(opts.el)).append(`<div class="mask"><i class="iconfont icon-remove"></i></div>`);
                }
                opts.success && opts.success({
                    "file": i,
                    "base64": imgSrc,
                    "formData": formData
                });
            };
        });
        // 判断数量
        if (opts.el) {
            var aImgLen = $('img',$(opts.el)).length;
            if (aImgLen == opts.maxLength - 1) {
                $(uplaod).fadeOut();
                return;
            }
        }
    }

    // tooltip
    $.fn.tooltip = function (option){
        var config = {
            msg: 'This is a tooltip',
            duration: 2000,
            align: 'center'
        },
        opts = $.extend(config, option);
        $('.qx-tooltip').remove();
        $('body').append(`<div role="tooltip" class="${opts.align ? opts.align : ''} qx-tooltip">${opts.msg}</div>`);
        $('.qx-tooltip').each(function (){
            $(this).delay(opts.duration).animate({ opacity: 0 }, function (){
                $(this).remove();
            });
        });
    }

    // messageBox
    $.fn.messageBox = function (option){
        var config = {
            title: '提示',
            showInput: false,
            message: 'This is a content',
            showCancelBtn: false,
            showConfirmBtn: true,
            cancelBtnText: '取消',
            confirmBtnText: '确定'
        },
        opts = $.extend(config, option);
        $('.qx-msgbox').remove();
        $('body').append(`
            <div role="dialog" aria-label="${opts.title}" class="qx-msgbox">
                <div class="qx-box">
                    <div class="qx-msg_header">
                        <div class="qx-msg_title">
                            <span>${opts.title}</span>
                        </div>
                        <i class="iconfont icon-forks"></i>
                    </div>
                    <div class="qx-msg_content">
                        ${opts.type && !opts.showInput ? `<i class="iconfont icon-${opts.type}"></i>` : ''}
                        <div class="qx-msg_main">${opts.message}</div>
                        ${opts.showInput ? `
                            <div class="qx-msg_input">
                                <div class="qx-input">
                                    <input type="${opts.type ? opts.type : 'text'}" autocomplete="off" ${opts.value ? `value=${opts.value}` : ''} ${opts.placeholder ? `placeholder=${opts.placeholder}` : ''} ${opts.maxLength ? `maxLength=${opts.maxLength}` : ''} class="qx-input_inner" />
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    <div class="qx-msg_btns">
                        ${opts.showCancelBtn ? `<button type="button" class="mini cancel qx-button"><span>${opts.cancelBtnText}</span></button>` : ''}
                        ${opts.showConfirmBtn ? `<button type="button" class="primary mini qx-button"><span>${opts.confirmBtnText}</span></button>` : ''}
                    </div>
                </div>
                <div class="mask"></div>
            </div>
        `);

        function close() {
            $('.qx-msgbox').animate({
                opacity: 0,"margin-top": '-50px'
            }, 'fast', function (){
                $(this).remove();
            });
        }
        $('.qx-msgbox .icon-forks, .qx-msgbox .mask').on('click', function (){
            close();
            opts.close && opts.close();
        });
        $('.qx-msgbox .primary').on('click', function (){
            close();
            opts.confirm && opts.confirm();
        });
        $('.qx-msgbox .cancel').on('click', function (){
            close();
            opts.cancel && opts.cancel();
        });
    }

    $.fn.layer = function (option){
        var config = {
            title: '提示',
            move: true,
            content: '',
            resize: true,
            iframe: true,
            area: [95, 85]
        },
        opts = $.extend(config, option);
        if (opts.area.length < 2) {
            $(this).message({
                type: 'error',
                msg: 'area 参数错误'
            });
            return;
        }
        for (let i of opts.area) {
            if (typeof i != 'number') {
                $(this).message({
                    type: 'error',
                    msg: 'area 参数错误'
                });
                return;
            }
        }
        var width = opts.area[0],
        height = opts.area[1],
        left = (100 - width) / 2,
        top = (100 - height) / 2;
        if (width > 100) width = 100;
        if (height > 100) height = 100;
        $('.qx-layer').remove();
        $('body').append(`
            <div role="layer" class="qx-layer" style="width:${width}%; height:${height}%; left:${left}%; top:${top}%">
                <div class="qx-layer-title">${opts.title}
                    <span class="iconfont icon-max"></span>
                    <span class="iconfont icon-forks"></span>
                </div>
                <div class="qx-layer-content">
                    ${opts.iframe ? `<iframe scrolling="auto" allowtransparency="true" style="height: ${$(window).height() * (height / 100) - 42}px" frameborder="0" src="${opts.content}"></iframe>` : opts.content}
                    ${opts.resize ? '<div class="resize"></div>' : ''}
                </div>
            </div>
            <div class="mask"></div>
        `);
        $('.qx-layer .icon-forks, .qx-layer+.mask').on('click', function (){
            $('.qx-layer').siblings('.mask').remove();
            $('.qx-layer').animate({'opacity': 0}).css({'transform': 'scale(.2)', 'visibility': 'hidden'});
            opts.close && opts.close();
        });
        var flag = true;
        $('.qx-layer .icon-max').on('click', function (){
            $('.qx-layer').animate({
                'top': flag ? 0 : top+'%',
                'left': flag ? 0 : left+'%',
                'width': flag ? '100%' : width+'%',
                'height': flag ? '100%' : height+'%',
            }, 'fast');
            flag = !flag;
        });
        if (opts.iframe) {
            $(window).resize(function (){
                $('.qx-layer iframe').css("height", $(window).height() * (height / 100) - 42);
            });
        }
        // move
        if (opts.move) {
            $('.qx-layer .qx-layer-title').mousedown(function (e){
                var e = e || window.event,
                offset = $(this).offset(),
                disY = e.pageY - offset.top,
                disX = e.pageX - offset.left,
                parents = $(this).parents('.qx-layer');
                $(document).mousemove(function (e){
                    var e = e || window.event,
                    y = e.pageY - disY,
                    x = e.pageX - disX;
                    if (x >= $(window).width() - $(parents).outerWidth(true) - 6) {
                        x = $(window).width() - $(parents).outerWidth(true);
                    } else if (x <= 6) {
                        x = 0;
                    }
                    if (y >= $(window).height() - $(parents).outerHeight(true) - 6) {
                        y = $(window).height() - $(parents).outerHeight(true);
                    } else if (y <= 6) {
                        y = 0;
                    }
                    $(parents).css({
                        top: y + 'px',
                        left: x + 'px'
                    });
                    return false;
                });
                $(document).on('mouseup mouseleave', function() {
                    $(document).off('mousemove mouseup');
                });
                return false;
            });
        }
        // resize
        if (opts.resize) {
            $('.qx-layer').mousedown(function (e){
                var e = e || window.event,
                layer = $(this),
                resize = $('.resize',this),
                disX = e.pageX - $(resize).position().left,
                disY = e.pageY - $(resize).position().top;
                $(document).mousemove(function (e){
                    var e = e || window.event,
                    l = e.pageX - disX + $(resize).outerWidth(),
                    t = e.pageY - disY + $(resize).outerHeight();
                    if (l <= 300) {
                        l = 300;
                    }
                    if (t <= 300) {
                        t = 300;
                    }
                    $(layer).css({
                        width: l + 'px',
                        height: t + 'px'
                    });
                    $('iframe',layer).css('height', t - 42);
                    return false;
                });
                $(document).on('mouseup mouseleave', function() {
                    $(document).off('mousemove mouseup');
                });
                return false;
            });
        }
    }

    // cascader
    $.fn.cascader = function (option){
        var config = {
            options: []
        },
        opts = $.extend(config, option),
        that = this;
        function createEle(data, fn) {
            //callback
            var fn = fn || function(){},
            $ul = $("<ul class='menus'></ul>");
            //创建li
            for (var i=0;i<data.length;i++) {
                if (data[i].children) {
                    var $li = $("<li><span>"+ data[i].label +"</span> <i class='iconfont icon-arrowright'></i></li>");
                } else {
                    var $li = $("<li><span>"+ data[i].label +"</span></li>");
                }
                (function(i){
                    $li.click(function(){
                        $(this).addClass('active').siblings().removeClass('active');
                        //清除
                        $ul.nextAll().remove();
                        if (data[i].children && data[i].children.length) {
                            //创建子菜单
                            createEle(data[i].children,function(ul){
                                //把创建好的子菜单插入到上一个菜单的后面
                                $ul.after(ul);
                            });
                        }
                        if (!data[i].children) {
                            var val = '',
                            icon = $('.icon-arrowdown',that),
                            cascader = $('.cascader-menu',that),
                            active = $('li.active',cascader);
                            $('.icon-check',cascader).remove();
                            var last = active.length - 1;
                            for (let i = 0; i < active.length; i++) {
                                let text = $(active).eq(i).text().trim();
                                if (i == last) {
                                    val += text;
                                } else {
                                    val += text+' / ';
                                }
                            }
                            $('input',that).val(val);
                            $(cascader).slideUp('fast');
                            $(icon).css('transform', 'rotate(0)');
                            $(active).eq(last).append('<i class="iconfont icon-check"></i>');
                            opts.change && opts.change(val);
                        }
                    })
                })(i)
                $ul.append($li);
            }
            fn($ul)
        }
        createEle(opts.options, function($ul){
            that.append("<div class='cascader-menu'><div class='cascader-panel'></div></div>")
            $('.cascader-panel',that).append($ul);
        });
        function cascaderInit() {
            $('.cascader-menu').slideUp('fast');
            $('.qx-cascader i').css('transform', 'rotate(0)');
        }
        $(document).click(function (e){
            var node = e.target.nodeName;
            if (node != 'INPUT' && node != 'SPAN' && node != 'LI' && node != 'I') {
                cascaderInit();
            }
        });
        $('body').off().on('click', '.qx-select', function (){
            cascaderInit();
            if (t.hasClass(this, 'cascader')) {
                var menus = $(this).parents().siblings('.cascader-menu'),
                icon = $('i',this);
                if ($(menus).css('display') == 'none') {
                    $(icon).css('transform', 'rotate(180deg)');
                    $(menus).slideDown().css('display', 'inline-block');
                } else {
                    $(icon).css('transform', 'rotate(0)');
                    $(menus).stop().slideUp('fast');
                }
            }
        });
    }

    // table
    $.fn.table = function(options) {
        var defaults = {
            titles: [],
            data: [],
            border: '',
            evenRowClass: '',
            oddRowClass: '',
            curRowClass: 'qx-curRow',
            overflowHeight: "260px",
            checked: null,
            switch: null,
            event: null
        },
        that = this,
        opts = $.extend(defaults, options),
        titles = opts.titles,
        datas = opts.data,
        checkAll = function(len1, len2, all) {
            var parent = $(all).parent();
            if (len1 == len2) {
                $(all).attr('checked', true);
                $(parent).removeClass('fuzzy').addClass('active');
            } else if (len1 > 0 && len1 < len2) {
                $(all).attr('checked', true);
                $(parent).addClass('fuzzy').removeClass('active');
            } else {
                $(all).removeAttr('checked');
                $(parent).removeClass('active').removeClass('fuzzy');
            }
        },
        init = function(dom) {
            var id = dom[0].id;
            $("#" + id).empty();
            var arrH = [];
            arrH.push("<div id='" + id + "-qxtable-head'>");
            arrH.push("<table class='qx-table'>");
            arrH.push("<thead id='" + id + "-thead'>");
            arrH.push("<tr>");
            $.each(titles,
            function(i, item) {
                var tdw = "";
                if (item.width) {
                    tdw = `width=${item.width}px`;
                }
                if (item.checkBox) {
                    arrH.push("<th " + tdw + "><span class='checkboxs'><input type='checkbox' name='AllChecks'/></span></th>");
                } else {
                    arrH.push("<th " + tdw + ">" + item.title + "</th>");
                }
            });
            arrH.push("</tr>");
            arrH.push("</thead>");
            arrH.push("</table>");
            arrH.push("</div>");
            dom.append(arrH.join(""));
            var arrB = [];
            arrB.push("<div id='" + id + "-qxtable-data'>");
            arrB.push(`<table class='qx-table ${opts.collapse ? 'collapse' : ''}'>`);
            arrB.push("<tbody id='" + id + "-tbody'>");
            $.each(datas,
            function(i, item) {
                arrB.push(`<tr data-idx=${i}>`);
                $.each(titles,
                function(j, item2) {
                    var tdw = "",
                    id = item.id,
                    pid = item.pid, //父ID
                    cid = item.cid, //类ID
                    collapse = opts.collapse, //折叠
                    defaults = opts.defaultClose; //默认
                    if (item2.width) {
                        tdw = `width=${item2.width}px`;
                    }
                    if (item2.checkBox) {
                        var checked = item.checked;
                        if (collapse && pid > 0) {
                            arrB.push(`<td ${pid ? `data-pid=${pid}` : ''} class="${defaults ? 'none' : ''}" ${tdw}><span class='${checked == '1' ? 'active ' : ''} checkboxs'><input type='checkbox' ${checked == '1' ? 'checked' : ''} name='Checks' value='${item[item2.keyName]}'/></span></td"">`);
                        } else {
                            arrB.push(`<td ${tdw}><span class='${checked == '1' ? 'active ' : ''} checkboxs'><input type='checkbox' ${checked == '1' ? 'checked' : ''} name='Checks' value='${item[item2.keyName]}'/></span></td"">`);
                        }
                    } else if (item2.switch) {
                        var switchBox = `
                            <div role="switch" class="${item[item2.keyName] == '1' ? 'is-checked ' : ''}${item[item2.disabled] ? 'is-disabled ' : ''}qx-switch" data-type="${item2.keyName}">
                                <input type="checkbox" name="" ${item[item2.keyName] == '1' ? 'checked' : ''} class="qx-form_input">
                                <span class="qx-switch_core"></span>
                            </div>
                        `;
                        if (collapse && pid > 0) {
                            arrB.push(`<td ${pid ? `data-pid=${pid}` : ''} class="${defaults ? 'none' : ''}" ${tdw}>${switchBox}</td>`);
                        } else {
                            arrB.push(`<td ${tdw}>${switchBox}</td>`);
                        }
                    } else {
                        if (item[item2.keyName] instanceof Array) {
                            $.each(item[item2.keyName], function (i, item3){
                                for (let i in item3) {
                                    if (i == item2.keysName) {
                                        var disabled = `${item[item2.disabled] ? 'disabled' : ''}`;
                                        if (collapse && pid > 0) {
                                            arrB.push(`<td ${pid ? `data-pid=${pid}` : ''} class="${defaults ? 'none ' : ''}${disabled}" ${tdw}><span>${item3[i]}</span></td>`);
                                        } else {
                                            arrB.push(`<td ${tdw} class="${disabled}"><span>${item3[i]}</span></td>`);
                                        }
                                    }
                                }
                            });
                        } else {
                            if (collapse && (pid == 0 || cid > 0) && j == 1) {
                                arrB.push(`<td ${id ? `data-cid=${id}` : ''} ${cid ? `data-pid="${cid}" class="none"` : ''} ${tdw}>
                                    ${cid ? `&nbsp;` : ''}
                                    <i class="iconfont icon-icondown ${defaults ? '' : 'active'}"></i>
                                    ${item2.default ? item2.default : item[item2.keyName]}
                                </td>`);
                            } else {
                                var disabled = `${item[item2.disabled] ? 'disabled' : ''}`;
                                if (collapse && pid > 0) {
                                    arrB.push(`<td ${pid ? `data-pid=${pid}` : ''} class="${defaults ? 'none ' : ''}${disabled}" ${tdw}>${item2.default ? item2.default : item[item2.keyName]}</td>`);
                                } else {
                                    arrB.push(`<td ${tdw} class="${disabled}">${item2.default ? item2.default : item[item2.keyName]}</td>`);
                                }
                            }
                        }
                    }
                });
                arrB.push("</tr>");
            });
            arrB.push("</tbody>");
            arrB.push("</table>");
            arrB.push("</div>");
            dom.append(arrB.join(""));

            // default
            var data = [],
            checks = $("#" + id + "-tbody>tr input[type='checkbox'][name='Checks']");
            $(checks).each(function(i, item) {
                var tr = $(item).parents('tr');
                if (item.checked) {
                    data.push({
                        tr: tr,
                        id: $(item).val(),
                        data: datas[$(tr).attr('data-idx')]
                    });
                    var cid = $(this).parents('td').siblings().attr('data-cid');
                    $(checks).each(function(i, item) {
                        var pid = $(item).parents('td').attr('data-pid');
                        if (pid) {
                            if (pid == cid) {
                                $(item).attr('checked', true);
                                $(item).parent().addClass('active');
                            }
                        }
                    });
                }
            });
            var dataLen = data.length;
            if (dataLen) {
                var allcheck = $("#" + id + "-thead>tr input[type='checkbox'][name='AllChecks']");
                checkAll(dataLen, checks.length, allcheck);
                opts.checked && opts.checked(data);
            }

            if (opts.switch) {
                // switch
                $(`#${id}`).off().on('click', '.qx-switch', function (){
                    setTimeout(() => {
                        var tr = $(this).parents('tr'),
                        i = $(tr).attr('data-idx'),
                        status = t.hasClass(this, 'is-checked');
                        // update
                        datas[i].status = status;
                        // callback
                        opts.switch({
                            tr: tr,
                            data: datas[i],
                            id: datas[i].id,
                            type: $(this).attr('data-type'),
                            elem: this,
                            status
                        });
                    });
                });
            }
            // event
            if (opts.event) {
                $('*[data-event]',`#${id}`).map((i, item) => {
                    var tr = $(item).parents('tr');
                    $(item).on('click', function (){
                        opts.event({
                            tr: tr,
                            data: datas[$(tr).attr('data-idx')],
                            event: $(this).attr('data-event')
                        });
                    });
                });
            }
            // collapse
            $(`#${id}`).on('click', 'td' ,function (){
                if($(this).attr('data-cid')) {
                    var cid = $(this).attr('data-cid'),
                    pid = $(this).attr('data-pid'),
                    icon = $('.iconfont',this),
                    hasClass = $(icon).hasClass('active');
                    if (hasClass) {
                        $(icon).removeClass('active');
                    } else {
                        $(icon).addClass('active');
                    }
                    for (let i of $(`#${id} td`)) {
                        var csid = $(i).attr('data-cid'),
                        cpid = $(i).attr('data-pid');
                        if (csid && cpid && !pid) {
                            for (let j of $(`#${id} td`)) {
                                if (csid == $(j).attr('data-pid')) {
                                    if (hasClass) {
                                        $(j).slideUp('fast');
                                        $('.iconfont',i).removeClass('active');
                                    }
                                }
                            }
                        }
                        if (cpid == cid) {
                            if (hasClass) {
                                $(i).slideUp('fast');
                            } else {
                                $(i).stop().slideDown('fast');
                            }
                        }
                    }
                }
            });
        },
        addRowColor = function(_id) {
            $("#" + _id + "-tbody tr:even").addClass(opts.evenRowClass);
            $("#" + _id + "-tbody tr:odd").addClass(opts.oddRowClass);
            $("#" + _id + "-tbody tr").hover(function() {
                $(this).addClass(opts.curRowClass);
            },
            function() {
                $(this).removeClass(opts.curRowClass);
            });
        },
        syncTableWidth = function(id) {
            var ths = $("#" + id + "-thead tr:eq(0) > th"),
            len = ths.length;
            ths.each(function(i) {
                if (i < len - 1) {
                    var tarTh = $(this),
                    srcTd = $("#" + id + "-tbody tr:eq(0) > td:eq(" + i + ")");
                    if (srcTd.length == 0) return;
                    var inW, outW, Width;
                    if (tarTh.attr("width")) {
                        inW = Math.ceil(tarTh.innerWidth());
                        outW = Math.ceil(tarTh.outerWidth());
                        Width = Math.ceil(tarTh.width());
                    } else {
                        inW = Math.ceil(srcTd.innerWidth());
                        outW = Math.ceil(srcTd.outerWidth());
                        Width = Math.ceil(srcTd.width());
                    }
                    srcTd.innerWidth(inW).outerWidth(outW).width(Width);
                    tarTh.innerWidth(inW).outerWidth(outW).width(Width);
                }
            });
        },
        setOverflowHeight = function(id) {
            $("#" + id + "-qxtable-data").css({
                "max-height": opts.overflowHeight,
                "overflow": "auto"
            });
            if (opts.border) {
                $(`#${id}`).addClass('qx-table-border');
            }
        }
        return this.each(function() {
            var _this = $(this),
            _this_id = _this[0].id;
            init(_this);
            addRowColor(_this_id);
            syncTableWidth(_this_id);
            setOverflowHeight(_this_id);
            addEvents(_this_id);
        });
        function addEvents(id) {
            var allcheck = $("#" + id + "-thead>tr input[type='checkbox'][name='AllChecks']"),
            checks = $("#" + id + "-tbody>tr input[type='checkbox'][name='Checks']"),
            len = checks.length;
            $(allcheck).click(function() {
                var data = [],
                f = this.checked,
                parent =$(this).parent();
                if (f) {
                    $(parent).removeClass('fuzzy').addClass('active');
                } else {
                    $(parent).removeClass('fuzzy').removeClass('active');
                }
                $("input[type='checkbox'][name='Checks']",that).each(function(i, item) {
                    var parent =$(item).parent(),
                    tr = $(parent).parents('tr');
                    if (f) {
                        $(parent).addClass('active');
                    } else {
                        $(parent).removeClass('active');
                    }
                    item.checked = f;
                    if (item.checked) {
                        data.push({
                            tr: tr,
                            id: $(item).val(),
                            data: datas[$(tr).attr('data-idx')]
                        });
                    }
                });
                opts.checked && opts.checked(data);
            });
            $(checks).click(function() {
                var num = 0,
                data = [],
                checked = this.checked,
                f = $(allcheck).is(':checked'),
                td = $('td',$(this).parents('tr'));
                if (f) {
                    $(allcheck).removeAttr('checked');
                }
                var curid = $(this).parents('td').attr('data-pid');
                for (let i of td) {
                    var cid = $(i).attr('data-cid');
                    if (cid) {
                        $(checks).each(function(i, item) {
                            var pid = $(item).parents('td').attr('data-pid');
                            if (!curid) {
                                for (let i of $('td',$(item).parents('tr'))) {
                                    var csid = $(i).attr('data-cid'),
                                    cpid = $(i).attr('data-pid');
                                    if (csid && cid == cpid) {
                                        $(checks).each(function(i, j) {
                                            var p = $(j).parent();
                                            if ($(j).parents('td').attr('data-pid') == csid) {
                                                if (checked) {
                                                    j.checked = true;
                                                    $(p).addClass('active');
                                                } else {
                                                    j.checked = false;
                                                    $(p).removeClass('active');
                                                }
                                            }
                                        });
                                    }
                                }
                            }
                            if (pid == cid) {
                                var parent = $(item).parent();
                                if (checked) {
                                    item.checked = true;
                                    $(parent).addClass('active');
                                } else {
                                    item.checked = false;
                                    $(parent).removeClass('active');
                                }
                            }
                        });
                    }
                }
                $(checks).each(function(i, item) {
                    var tr = $(this).parents('tr'),
                    i = $(tr).attr('data-idx');
                    if (item.checked) {
                        $(this).attr('checked', true);
                        $(this).parent().addClass('active');
                        num++;
                    } else {
                        $(this).removeAttr('checked');
                        $(this).parent().removeClass('active');
                    }
                    if (item.checked && i >= 0) {
                        data.push({
                            tr: tr,
                            id: $(item).val(),
                            data: datas[i]
                        });
                    }
                });
                checkAll(num, len, allcheck);
                opts.checked && opts.checked(data);
            });
        }
    }
    // collapseAll
    $.fn.collapseAll = function (){
        $('td[data-cid]',this).each(function (){
            $('.icon-icondown',this).removeClass('active');
        });
        $('td[data-pid]',this).each(function (){
            $(this).slideUp('fast');
        });
    }
    // expandAll
    $.fn.expandAll = function (){
        $('td[data-cid]',this).each(function (){
            $('.icon-icondown',this).addClass('active');
        });
        $('td[data-pid]',this).each(function (){
            $(this).slideDown('fast');
        });
    }

    // collapse
    $.fn.collapse = function (){
        $(this).on('click', '.panel-header', function (){
            $(this).siblings('.panel-collapse').slideDown('fast');
            $('.panel-collapse',$(this).parents('.panel').siblings()).slideUp('fast');
        });
    }

    // close parents layer
    $.fn.closeLayer = function (option){
        var config = {},
        opts = $.extend(config, option),
        layer = $(".qx-layer",window.parent.document);
        $(layer).animate({'opacity': 0}).css({
            'transform': 'scale(.2)',
            'visibility': 'hidden'
        }).siblings('.mask').remove();
        if (opts.refresh) {
            parent.location.reload();
        }
    }

    // clearStorage
    $.fn.clearStorage = function (option){
        var config = {},
        opts = $.extend(config, option);
        if (opts.key) {
            t.setStorage(opts.key, []);
            window.location.href = '/login';
        }
    } 
})(window.jQuery);

// render
;(function (){
    // cascader
    $('qx-cascader').each(function (){
        var size = $(this).attr('size'),
        name = $(this).attr('name'),
        place = $(this).attr('placeholder');
        $(this).wrapAll(`
        <div class="qx-cascader">
            <div class="qx-select cascader ${size ? `${size} ` : ''}qx-input">
                <input type="text" readonly autocomplete="off" ${name ? `name=${name}` : ''} placeholder="${place ? place : '请选择'}" class="qx-input_inner">
                <span class="qx-input_suffix">
                    <i class="qx-input_icon iconfont icon-arrowdown" style="transform: rotate(0deg);"></i>
                </span>
            </div>
        </div>`).remove();
    });

    // avatar
    $('qx-avatar').each(function (){
        var text = $(this).text(),
        src = $(this).attr('src'),
        alt = $(this).attr('alt'),
        fit = $(this).attr('fit'),
        icon = $(this).attr('icon'),
        size = $(this).attr('size'),
        shape = $(this).attr('shape'),
        isNumber = isNaN(size) ? false : true;
        $(this).wrapAll(`
            <span class="${!isNumber && size ? `qx-avatar-${size} ` : ''}${shape ? `qx-avatar-${shape} ` : ''}qx-avatar" ${isNumber ? `style="width: ${size}px; height: ${size}px; line-height: ${size}px"` : ''}>
                ${src ? `<img src="${src}" style="object-fit: ${fit ? fit : 'cover'};" ${alt ? `alt="${alt}"` : ''}>` : ''}
                ${!src && icon ? `<i class="iconfont ${icon}"></i>` : ''}
                ${!src && !icon && text ? `<span>${text}</span>` : ''}
            </span>
        `).remove();
    });

    // breadcrumb
    $('qx-breadcrumb').each(function (index){
        $(this).wrapAll('<div role="navigation" class="qx-breadcrumb"></div>').remove();
        var item = '',
        icon = $(this).attr('icon'),
        separ = $(this).attr('separator'),
        breadItem = $('qx-breadcrumb-item',this);
        $(breadItem).each(function (index){
            var text = $(this).html(),
            last = index == $(breadItem).length - 1;
            item += `
                <span class="qx-breadcrumb_item">
                    <span class="qx-bread_inner">${text}</span>
                    ${icon && !last ? `<i class="qx-bread_separator iconfont ${icon}"></i>` : ''}
                    ${!icon && !last ? `<span class="qx-bread_separator">${separ ? separ : '/'}</span>` : ''}
                </span>
            `
        });
        $('.qx-breadcrumb').eq(index).html(item);
    });

    // button
    $('qx-button').each(function (){
        var text = $(this).text(),
        type = $(this).attr('type'),
        size = $(this).attr('size'),
        icon = $(this).attr('icon'),
        iClass = $(this).attr('class'),
        native = $(this).attr('native'),
        disabled = $(this).attr('disabled'),
        round = t.getAttr(this, 'round'),
        upload = t.getAttr(this, 'upload');
        $(this).wrapAll(`<button type="${native ? native : 'button'}" class="${iClass ? iClass : ''} ${icon == 'icon-loading' ? 'is-loading ' : ''}${type ? type+' ' : ''}${round ? 'round ' : ''}${size ? size+' ' : ''}${disabled ? 'is-disabled ' : ''}qx-button">
            ${upload ? `<input type="file" id="fileUp" multiple name="file" />` : ''}
            ${icon ? `<i class="iconfont ${icon}"></i>` : ''}${text ? `<span>${text}</span>` : ''}
        </button>`).remove();
    });

    // collapse
    setTimeout(() => {
        $('qx-collapse').each(function (index){
            $(this).wrapAll('<div class="qx-collapse" id="accordion"></div>').remove();
            var panel = '';
            $('qx-panel',this).each(function() {
                var iClass = $(this).attr('class');
                panel += `
                    <div class="panel">
                        <div class="panel-header">
                            <h4 class="panel-title">${$(this).attr('label')}</h4>
                        </div>
                        <div class="panel-collapse ${iClass ? iClass : ''}">
                            <div class="panel-body">${$(this).html()}</div>
                        </div>
                    </div>
                `;
            });
            $('.qx-collapse').eq(index).html(panel);
        });
        $(document).collapse();

        // radio
        if ($('qx-radio').length > 0) {
            $('qx-radio').each(function (index) {
                var name = $(this).attr('name'),
                size = $(this).attr('size'),
                value = $(this).attr('value'),
                checked = $(this).attr('checked'),
                button = t.getAttr(this, 'button'),
                bordered = t.getAttr(this, 'bordered');
                $(this).wrapAll(`<label role="radio" class="${size ? size+' ' : ''}${bordered ? 'qx-radio-border ' : ''}${button ? 'qx-radio-button ' : ''}qx-radio" ${checked ? 'aria-checked="true"' : ''}>`);
                $('.qx-radio').eq(index).html(`
                    <span class="${checked ? 'is-checked ' : ''}${$(this).attr('disabled') ? 'is-disabled ' : ''}qx-radio_input">
                        <span class="qx-radio_inner"></span>
                        <input type="radio" name="${name ? name : ''}" ${checked ? 'checked' : ''} value="${value}" class="qx-form_input" />
                    </span>
                    <span class="qx-form_label">${$(this).text()}</span>
                `);
                checked ? g.radioed[name] = value : '';
            });
            $(document).radio();
        }

        // checkbox
        if ($('qx-checkbox-group').length <= 0) {
            g.checked.push([]);
            $('qx-checkbox').each(function (index) {
                var name = $(this).attr('name'),
                size = $(this).attr('size'),
                checked = $(this).attr('checked'),
                button = t.getAttr(this, 'button'),
                bordered = t.getAttr(this, 'bordered');
                $(this).wrapAll(`<label role="checkbox" class="${size ? size+' ' : ''}${bordered ? 'qx-checkbox-border ' : ''}${button ? 'qx-checkbox-button ' : ''}qx-checkbox" ${checked ? 'aria-checked="true"' : ''}></label>`);
                $('.qx-checkbox').eq(index).html(`
                    <span class="${checked ? 'is-checked ' : ''}${$(this).attr('disabled') ? 'is-disabled ' : ''}qx-checkbox_input" data-idx="${index}">
                        <span class="qx-checkbox_inner"></span>
                        <input type="checkbox" name="${name ? name : ''}" ${checked ? 'checked' : ''} value="${$(this).attr('value')}" class="qx-form_input" />
                    </span>
                    <span class="qx-form_label">${$(this).text()}</span>
                `);
                if (checked) {
                    g.checked[0].push({
                        id: `${index}`,
                        value: $('input',$('.qx-checkbox').eq(index)).val()
                    });
                }
            });
            $(document).checkbox();
        } else {
            // checkbox-group
            $('qx-checkbox-group').each(function (idx){
                $(this).wrapAll(`<div class="qx-checkbox-group" group-idx="${idx}"></div>`);
                g.checked.push([]);
                var checkbox = '';
                $('qx-checkbox',this).each(function (index){
                    var name = $(this).attr('name'),
                    size = $(this).attr('size'),
                    value = $(this).attr('value'),
                    checked = $(this).attr('checked'),
                    button = t.getAttr(this, 'button'),
                    bordered = t.getAttr(this, 'bordered');
                    checkbox += `<label role="checkbox" class="${size ? size+' ' : ''}${bordered ? 'qx-checkbox-border ' : ''}${button ? 'qx-checkbox-button ' : ''}qx-checkbox" ${checked ? 'aria-checked="true"' : ''}>
                        <span class="${checked ? 'is-checked ' : ''}${$(this).attr('disabled') ? 'is-disabled ' : ''}qx-checkbox_input" data-idx="${index}">
                            <span class="qx-checkbox_inner"></span>
                            <input type="checkbox" name="${name ? name : ''}" ${checked ? 'checked' : ''} value="${value}" class="qx-form_input" />
                        </span>
                        <span class="qx-form_label">${$(this).text()}</span>
                    </label>`;
                    if (checked) {
                        g.checked[idx].push({
                            id: `${index}`,
                            value
                        });
                    }
                });
                $('.qx-checkbox-group').eq(idx).html(checkbox);
            });
            $(document).checkbox();
        }

        // select
        if ($('qx-select').length > 0) {
            $('qx-select').each(function (index){
                var empty = '',
                value = '',
                options = '',
                size = $(this).attr('size'),
                icon = $(this).attr('icon'),
                name = $(this).attr('name'),
                place = $(this).attr('placeholder'),
                disabled = $(this).attr('disabled'),
                iconGroup = t.getAttr(this, 'icon-group'),
                filter = t.getAttr(this, 'filterable'),
                multi = t.getAttr(this, 'multiple');
                $(this).wrapAll(`<div role="select" class="${multi ? 'is-multiple ' : ''}${filter ? 'is-filter ' : ''}${disabled ? 'is-disabled ' : ''}${iconGroup ? 'icon ' : ''}qx-select"></div>`)
                if ($('qx-option',this).length) {
                    $('qx-option',this).each(function (){
                        var checked = $(this).attr('checked'),
                        itemVal = $(this).attr('value'),
                        itemLabel = $(this).attr('label');
                        if (checked) {
                            icon = itemVal;
                            value = itemLabel;
                        }
                        if (!iconGroup) {
                            options += `<li class="${checked ? 'active ' : ''}qx-select_item" data-val="${itemVal}">${itemLabel}<span class="hook iconfont icon-hook"></span></li>`;
                        }
                    });
                    empty = '';
                } else {
                    empty = '暂无数据';
                }
                if (iconGroup) {
                    var iconGroup = g.icon.split(',');
                    for (let i = 0; i < iconGroup.length; i++) {
                        options += `<li class="qx-select_item" data-idx="${i}"><i class="iconfont icon-${iconGroup[i]}"></i></li>`;
                    }
                    empty = '';
                }
                var isIcon = iconGroup && icon;
                $('.qx-select:not(.cascader)').eq(index).html(`
                    <div class="qx-input ${size ? size : ''}">
                        <input type="text" ${!filter ? 'readonly' : ''} name="${name ? name : ''}" value="${isIcon ? ' ' : value}" autocomplete="off" ${place ? `placeholder="${place}"` : ''} data-value="${isIcon ? `iconfont icon-${icon}` : icon}" class="qx-input_inner" />
                        ${isIcon ? `<i class="iconfont icon-${icon}"></i>` : ''}
                        <span class="qx-input_suffix">
                            <i class="qx-input_icon iconfont icon-arrowdown"></i>
                        </span>
                    </div>
                    <div class="qx-select-dropdown">
                        <div class="qx-scrollbar">
                            <div class="qx-scrollbar_wrap">
                                <ul class="qx-select_list">${options}</ul>
                                <div class="qx-select_empty" style="display: ${empty ? 'block' : ''}">${empty}</div>
                            </div>
                            <div class="qx-scrollbar_bar">
                                <div class="thumb"></div>
                            </div>
                        </div>
                    </div>
                `);
            });
            $(document).select();
        }

        // switch
        if ($('qx-switch').length > 0) {
            $('qx-switch').each(function (index){
                var name = $(this).attr('name'),
                checked = $(this).attr('checked'),
                disabled = $(this).attr('disabled'),
                activeTxt = $(this).attr('active-text'),
                inactiveTxt = $(this).attr('inactive-text'),
                activeVal = $(this).attr('active-value'),
                inactiveVal = $(this).attr('inactive-value');
                $(this).wrapAll(`<div role="switch" class="${checked ? 'is-checked ' : ''}${disabled ? 'is-disabled ' : ''}qx-switch"></div>`);
                $('.qx-switch').eq(index).html(`
                    <input type="checkbox" name="${name ? name : ''}" ${activeVal ? `true-value="${activeVal}"` : ''} ${inactiveVal ? `false-value="${inactiveVal}"` : ''} ${checked ? 'checked' : ''} class="qx-form_input" />
                    ${inactiveTxt ? `<span class="${!checked ? 'is-active ' : ''}qx-switch_label">${inactiveTxt}</span>` : ''}
                    <span class="qx-switch_core"></span>
                    ${activeTxt ? `<span class="${checked ? 'is-active ' : ''}qx-switch_label">${activeTxt}</span>` : ''}
                `);
            });
        }
        $(document).switch();

        // input
        if ($('qx-input').length > 0) {
            $('qx-input').each(function (){
                var type = $(this).attr('type'),
                rows = $(this).attr('rows'),
                cols = $(this).attr('cols'),
                size = $(this).attr('size'),
                name = $(this).attr('name'),
                value = $(this).attr('value'),
                max = $(this).attr('maxlength'),
                resize = $(this).attr('resize'),
                disabled = $(this).attr('disabled'),
                readonly = $(this).attr('readonly'),
                required = $(this).attr('required'),
                autofocus = $(this).attr('autofocus'),
                place = $(this).attr('placeholder'),
                auto = $(this).attr('autocomplete'),
                showWord = t.getAttr(this, 'show-word'),
                showPass = t.getAttr(this, 'show-pass'),
                clear = t.getAttr(this, 'clearable');
                if (type == 'textarea') {
                    $(this).wrapAll(`
                        <div class="${disabled ? 'is-disabled' : ''}${showWord ? 'showWord ' : ''}qx-input qx-textarea">
                            <textarea 
                                class="qx-area_inner"
                                cols=${cols ? cols : 33}
                                rows=${rows ? rows : 3}
                                ${readonly ? readonly : ''}
                                ${disabled ? 'disabled' : ''}
                                ${autofocus ? autofocus : ''}
                                ${name ? `name=${name}` : ''}
                                ${required ? 'required' : ''}
                                ${max ? `maxlength=${max}` : ''}
                                ${place ? `placeholder=${place}` : ''}
                                ${auto ? `autocomplete=${auto}` : ''}
                                ${resize ? `style="resize:${resize}"` : ''}>${value ? value : ''}</textarea>
                            ${showWord && max ? `<span class="qx-input-suffix"><span class="qx-input_count"><span class="num">${value ? value.length : 0}</span>/${max ? max : 30}</span></span>` : ''}
                        </div>
                    `).remove();
                } else {
                    $(this).wrapAll(`
                        <div class="${size ? size+' ' : ''}${disabled ? 'is-disabled ' : ''}${showWord ? 'showWord ' : ''}qx-input">
                            <input 
                                type="${type ? type : 'text'}"
                                ${readonly ? readonly : ''}
                                ${name ? `name=${name}` : ''}
                                ${autofocus ? autofocus : ''}
                                ${disabled ? 'disabled' : ''}
                                ${required ? 'required' : ''}
                                ${value ? `value=${value}` : ''}
                                ${max ? `maxlength=${max}` : ''}
                                ${place ? `placeholder=${place}` : ''}
                                ${auto ? `autocomplete=${auto}` : ''}
                                class="${showPass || clear ? 'suffix ' : ''}qx-input_inner" />
                            ${showPass ? `<span class="qx-input-suffix"><i class="iconfont icon-see"></i></span>` : ''}
                            ${clear ? `<span class="qx-input-suffix"><i class="iconfont icon-closes"></i></span>` : ''}
                            ${showWord && max ? `<span class="qx-input-suffix"><span class="qx-input_count"><span class="num">${value ? value.length : 0}</span>/${max ? max : 10}</span></span>` : ''}
                        </div>
                    `).remove();
                }
            });
            $(document).input();
        }
    });

    // time
    $('qx-time').each(function (){
        var name = $(this).attr('name'),
        value = $(this).attr('value'),
        place = $(this).attr('placeholder');
        $(this).wrapAll(`
            <div class="qx-input qx-datepicker-editor qx-single-editor">
                <i class="qx-datepicker_icon kxiconfont icon-clock"></i>
                <input type="text" autocomplete="off" readonly ${name ? `name='${name}'` : ''} ${value ? `value='${value}'` : ''} placeholder='${place ? place : '请选择时间'}' class="c-datepicker-data-input only-date" />
            </div>
        `).remove();
    });
    // range
    $('qx-time-range').each(function (){
        var place = $(this).attr('placeholder'),
        value = $(this).attr('value'),
        name = $(this).attr('name'),
        p = place ? place.split(',') : [],
        v = value ? value.split(',') : [],
        n = name ? name.split(',') : [];
        $(this).wrapAll(`
            <div class="qx-input qx-datepicker-editor qx-single-editor">
                <i class="qx-datepicker_icon kxiconfont icon-clock"></i>
                <input autocomplete="off" readonly placeholder='${p[0] ? p[0] : '开始时间'}' ${n[0] ? `name='${n[0]}'` : ''} ${v[0] ? `value='${v[0]}'` : ''} class="c-datepicker-data-input only-time" />
                <span class="qx-datepicker-separator">-</span>
                <input autocomplete="off" readonly placeholder='${p[1] ? p[1] : '结束时间'}' ${n[1] ? `name='${n[1]}'` : ''}  ${v[1] ? `value='${v[1]}'` : ''} class="c-datepicker-data-input only-time" />
            </div>
        `).remove();
    });
    // date
    $('qx-date').each(function (){
        var name = $(this).attr('name'),
        value = $(this).attr('value'),
        place = $(this).attr('placeholder');
        $(this).wrapAll(`
            <div class="qx-input qx-datepicker-editor qx-single-editor">
              <i class="qx-datepicker_icon kxiconfont icon-clock"></i>
              <input type="text" autocomplete="off" readonly ${value ? `value='${value}'` : ''} ${name ? `name='${name}'` : ''} placeholder='${place ? place : '请选择日期'}' class="c-datepicker-data-input only-date" />
            </div>
        `).remove();
    });
    // range
    $('qx-date-range').each(function (){
        var place = $(this).attr('placeholder'),
        value = $(this).attr('value'),
        name = $(this).attr('name'),
        p = place ? place.split(',') : [],
        v = value ? value.split(',') : [],
        n = name ? name.split(',') : [];
        $(this).wrapAll(`
            <div class="qx-input qx-datepicker-editor">
              <i class="qx-datepicker_icon kxiconfont icon-clock"></i>
              <input autocomplete="off" readonly placeholder='${p[0] ? p[0] : '开始日期'}' ${v[0] ? `value='${v[0]}'` : ''} ${n[0] ? `name='${n[0]}'` : ''} class="c-datepicker-data-input only-date" />
              <span class="qx-datepicker-separator">-</span>
              <input autocomplete="off" readonly placeholder='${p[1] ? p[1] : '结束日期'}' ${v[1] ? `value='${v[1]}'` : ''} ${n[1] ? `name='${n[1]}'` : ''} class="c-datepicker-data-input only-date" />
            </div>
        `).remove();
    });
    // datetime
    $('qx-datetime').each(function (){
        var name = $(this).attr('name'),
        value = $(this).attr('value'),
        place = $(this).attr('placeholder');
        $(this).wrapAll(`
            <div class="qx-input qx-datepicker-editor qx-single-editor">
              <i class="qx-datepicker_icon kxiconfont icon-clock"></i>
              <input type="text" autocomplete="off" readonly ${value ? `value='${value}'` : ''} ${name ? `name='${name}'` : ''} placeholder='${place ? place : '请选择日期时间'}' class="c-datepicker-data-input"/>
            </div>
        `).remove();
    });
    // range
    $('qx-datetime-range').each(function (){
        var place = $(this).attr('placeholder'),
        value = $(this).attr('value'),
        name = $(this).attr('name'),
        p = place ? place.split(',') : [],
        v = value ? value.split(',') : [],
        n = name ? name.split(',') : [];
        $(this).wrapAll(`
            <div class="qx-input qx-datepicker-editor">
                <i class="qx-datepicker_icon kxiconfont icon-clock"></i>
                <input autocomplete="off" readonly placeholder='${p[0] ? p[0] : '开始日期时间'}' ${v[0] ? `value='${v[0]}'` : ''} ${n[0] ? `name='${n[0]}'` : ''} class="c-datepicker-data-input only-date" />
                <span class="qx-datepicker-separator">-</span>
                <input autocomplete="off" readonly placeholder='${p[1] ? p[1] : '结束日期时间'}' ${v[1] ? `value='${v[1]}'` : ''} ${n[1] ? `name='${n[1]}'` : ''} class="c-datepicker-data-input only-date" />
            </div>
        `).remove();
    });

    // Form
    $('qx-form').each(function (index){
        var method = $(this).attr('method'),
        action = $(this).attr('action'),
        target = $(this).attr('target'),
        enctype = $(this).attr('enctype'),
        charset = $(this).attr('accept-charset');
        $(this).wrapAll(`<form class="qx-form" onsubmit="return false" ${method ? `method=${method}` : ''} ${action ? `action=${action}` : ''} ${target ? `target=${target}` : ''} ${enctype ? `enctype=${enctype}` : ''} ${charset ? `charset=${charset}` : ''}></form>`);
        var width = $(this).attr('label-width'), formItem = '';
        $('qx-form-item',this).each(function (){
            var prop = $(this).attr('prop'), label = $(this).attr('label');
            formItem+=`
                <div class="qx-form-item" ${prop ? `prop=${prop}` : ''}>
                    ${label ? `<label class="qx-form_label" ${width ? `style="width: ${width}"` : ''}>${label}</label>` : ''}
                    <div class="qx-form_con">${$(this).html()}</div>
                </div>
            `;
        });
        $('.qx-form').eq(index).html(formItem);
    });

    // page 
    $('qx-pagination').each(function (){
        var bgColor = $(this).attr('background'),
        small = t.getAttr(this, 'small');
        $(this).wrapAll(`<div class="${small ? 'small ' : ''}pagination ${bgColor ? bgColor : ''}"></div>`).remove();
    });

    // tabs
    if ($('qx-tabs').length > 0) {
        $('qx-tabs').each(function (){
            var pane = '', tabs = '',
            type = $(this).attr('type'),
            closable = t.getAttr(this, 'closable');
            $('qx-tab-pane',this).each(function (index){
                pane += `<div class="${index == 0 ? 'active ' : ''}qx-tab-pane" data-idx="${index}">${$(this).html()}</div>`;
                tabs += `<div class="${index == 0 ? 'active ' : ''}qx-tabs_item" data-idx="${index}">${$(this).attr('value')} ${closable ? '<span class="iconfont icon-forks"></span>' : ''}</div>`;
            });
            $(this).wrapAll(`
                <div class="${type ? type+' ' : ''}${closable ? 'closable ' : ''}qx-tabs">
                    <div class="qx-tabs_head">
                        <div class="qx-tabs_nav">${tabs}</div>
                    </div>
                    <div class="qx-tabs_con">${pane}</div>
                </div>
            `).remove();
            g.paneLen = g.itemLen = $('.qx-tabs_item').length;
        });
        $(document).tabs();
    }

    // qx-top
    $('.qx-top .toggle').hover(function (){
        $('.nav-child',this).stop().fadeIn('fast').clearQueue().animate({
            top: '48px'
        }, 'fast');
        $('.icon-icondown',this).css('transform', 'rotate(180deg)');
    }, function (){
        $('.nav-child',this).stop().fadeOut('fast').clearQueue().animate({
            top: '65px'
        });
        $('.icon-icondown',this).css('transform', 'rotate(0)');
    });
    // nav open
    $('.qx-top .left_open').on('click', function (){
        var page = $('#page-container'),
        navMenu = $('.qx-navmenu, #side-nav'),
        navText = $('.qx-navmenu .right'),
        subMenu = $('.qx-navmenu .sub-menu'),
        menuIcon = $('.icon-menu',this);
        if (t.hasClass(menuIcon, 'icon-menuopen')) {
            $(navText).show();
            $(page).css('left', '220px');
            $(navMenu).css('width', '220px');
            $(menuIcon).removeClass('icon-menuopen');
        } else {
            $(navText).hide();
            $(subMenu).hide();
            $(page).css('left', '60px');
            $(navMenu).css('width', '60px');
            $(menuIcon).addClass('icon-menuopen');
        }
    });

    // init nav
    g.selectedNav.map((i, index) => {
        if (index == g.selectedNav.length-1) {
            i.active = true;
        } else {
            i.active = false;
        }
        if (i.active) {
            for (let j of $('#side-nav .sub-menu span')) {
                if ($(j).text() == i.title) {
                    $(j).parent().addClass('active');
                    $('.right i',$(j).parents('li')).addClass('icon-arrowdown');
                } else {
                    $(j).parent().removeClass('active');
                }
            }
        }
        if (index == g.selectedNav.length-1) {
            $(document).tabs({
                addItem: {
                    title: `${i.title}`,
                    pack: '#page-container',
                    content: `<iframe frameborder="0" src="${i.url}" scrolling="yes"></iframe>`
                }
            });
        } else {
            $(document).tabs({
                addItem: {
                    title: `${i.title}`,
                    pack: '#page-container',
                    content: `<iframe frameborder="0" data-src="${i.url}" scrolling="yes"></iframe>`
                }
            });
        }
    });
    var pane = $('.qx-tabs .qx-tab-pane');
    if (pane.length == 1) {
        t.setFrameSrc($('iframe',pane).eq(0));
    }
    // tabs init
    function TabInit(that) {
        var url = $(that).attr('data-href'), text = $(that).text();
        if (t.hasClass(that, 'active') && url != 'javascript:;' && url != 'javascript:void(0)') {
            $(that).tabs({
                addItem: {
                    title: `${text}`,
                    content: `<iframe frameborder="0" src="${url}" scrolling="yes"></iframe>`
                }
            });
            g.selectedNav = g.selectedNav.map((item, index) => {
                if (index == g.selectedNav.length-1) {
                    item.active = true;
                } else {
                    item.active = false;
                }
                return item;
            });
            t.setStorage('tagList', JSON.stringify(g.selectedNav));
        }
    }
    // qx-navmenu
    $('.qx-navmenu a').each(function (){
        if (t.hasClass(this, 'active')) {
            $(this).parents('.sub-menu').slideDown();
            $(this).siblings('.sub-menu').slideDown();
            if (t.getStorage('tagIndex') == 0) {
                g.selectedNav.push({
                    title: $(this).text().trim(),
                    url: $(this).attr('data-href'),
                    active: true
                });
                TabInit(this);
            }
            t.setStorage('tagIndex', -1);
        }
    });
    $('.qx-navmenu').on('click', 'a', function (){
        var nav = $(this).parents('#nav'),
        aLi = $(this).parents('li').siblings(),
        subMenu = $(this).siblings('.sub-menu'),
        arrow = $('.icon-arrowright',this);
        $('#page-container').css('left', '220px');
        $('.qx-navmenu, #side-nav').css('width', '220px');
        $('.qx-top .icon-menu').removeClass('icon-menuopen');
        $('a',nav).removeClass('active');
        $('.sub-menu',aLi).slideUp();
        $('.qx-navmenu .right').show();
        $(this).addClass('active');
        if ($(this).attr('href')) {
            $('i',aLi).removeClass('icon-arrowdown');
        }
        if ($(this).attr('href'), t.hasClass(this, 'active')) {
            if ($(subMenu).css('display') == 'none') {
                $(subMenu).slideDown();
                $(arrow).addClass('icon-arrowdown');
            } else {
                $(subMenu).stop().slideUp();
                $(arrow).removeClass('icon-arrowdown');
            }
        }
        var url = $(this).attr('data-href'), title = $(this).text().trim();
        if (url && title) {
            var tabItem = $('.qx-tabs .qx-tabs_item'),
            tabPane = $('.qx-tabs .qx-tab-pane');
            for (let i=0; i < tabPane.length; i++){
                var pane = $(tabPane).eq(i),
                item = $(tabItem).eq(i),
                iframe = $('iframe',pane),
                src = $(iframe).attr('data-src');
                if(url == src || title == $(item).text().trim()){
                    t.setFrameSrc(iframe);
                    $(item).addClass('active').siblings().removeClass('active');
                    $(pane).addClass('active').siblings().removeClass('active');
                    return;
                }
            }
            g.selectedNav.push({
                title, url
            });
            TabInit(this);
        }
    });
})(window);